<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns=""
      th:replace="~{fragments/default :: html(content=~{::body})}">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div class="container">
    <h1>검색결과</h1>
    <!--    카테고리 선택된 검색결과-->
    <div th:if="${category!='all'}">
        <h2 th:text="${category}+' 검색결과'"></h2>
        <div th:each="p : ${postPage.content}">
            <p th:text="'ㅁ'+${p.postCont}"></p>
        </div>
        <div id="moreResultDiv">

        </div>
        <button onclick="loadMore()">더보기</button>
    </div>

    <!--통합검색결과-->
    <div th:if="${category=='all'}">
        <h2>통합검색</h2>
        <div>
            <h3>자유게시판 검색결과</h3>
            <div th:each="p : ${freePostPage.content}">
                <p th:text="'ㅁ'+${p.postCont}"></p>
            </div>
            <a th:href="@{/community/search_result.do(category='free',keyword=${keyword})}">자유게시판 검색결과 더보기</a>
        </div>
        <div>
            <h3>손익인증 검색결과</h3>
            <div th:each="p : ${pnlPostPage.content}">
                <p th:text="'ㅁ'+${p.postCont}"></p>
            </div>
            <a th:href="@{/community/search_result.do(category='pnl',keyword=${keyword})}">손익인증 검색결과 더보기</a>
        </div>
        <div>
            <h3>차트분석 검색결과</h3>
            <div th:each="p : ${chartPostPage.content}">
                <p th:text="'ㅁ'+${p.postCont}"></p>
            </div>
            <a th:href="@{/community/search_result.do(category='chart',keyword=${keyword})}">차트분석 검색결과 더보기</a>
        </div>
        <div>
            <h3>전문가 검색결과</h3>
            <div th:each="p : ${expertPostPage.content}">
                <p th:text="'ㅁ'+${p.postCont}"></p>
            </div>
            <a th:href="@{/community/search_result.do(category='expert',keyword=${keyword})}">전문가게시판 검색결과 더보기</a>
        </div>
    </div>
</div>
<script>
    const moreResultDiv = document.getElementById('moreResultDiv')
    const urlParams = new URLSearchParams(window.location.search)
    const category = urlParams.get('category')
    const keyword = urlParams.get('keyword')
    let page = 0;
    let html = ""

    async function loadMore() {
        page++
        console.log(page)
        const response = await fetch(`/community/api/search?category=${category}&keyword=${keyword}&page=${page}`)
        const responseJson = await response.json()
        const contents = responseJson.content
        for (c of contents) {
            html += `<p>ㅁ${c.postCont}</p>`
        }
        moreResultDiv.innerHTML = html;
    }
</script>
</body>
</html>

<!--for(g : guidelist){

}-->